"use strict";(self.webpackChunkpackage_library=self.webpackChunkpackage_library||[]).push([[1592],{1592:(e,a,t)=>{t.d(a,{Z:()=>Re});var n=t(540),i=t.n(n),r=t(607),o=t(9530),s=t.n(o),l=t(7838),c=t(9245),d=t(9578),u=t(6246),p=t(8053),g=t(8560),m=t(9437),h=t(3622),v=t(429),y=t(8022),k=t(5869),x=t(4583),b=t(6880),f=t(6417),j=t(2322);const C=({searchValue:e,onSearch:a})=>{const t=e=>{a(e)};return(0,j.jsx)(f.Z,{type:"search",placeholder:"Find packages...",value:e,onChange:e=>t(e.target.value),onClear:()=>{t("")}})};var w=t(4962),_=t(5736),I=t(6189),Z=t(6669);const S=s()(g.Z).withConfig({displayName:"user-avatar__AvatarItemContainer",componentId:"sc-1uidpfc-0"})(["*:not(:last-child){margin-right:var(--spacing-xs);}"]),P=s()(_.Z).withConfig({displayName:"user-avatar__StyledSpinner",componentId:"sc-1uidpfc-1"})(["margin-left:var(--spacing-xs);"]),E=({userId:e})=>{const{data:a,isLoading:t}=(0,Z.usePublicProfile)({userIds:[String(e)],type:"user"}),{data:n}=(0,Z.useTeamsByUserId)(),i=(0,Z.isUserPartner)(String(e),null==n?void 0:n.organizations[0]),r=null==a?void 0:a[e];return(0,j.jsxs)(S,{alignItems:"center",gap:"spacing-s","data-testid":"avatar-container",children:[(0,j.jsx)(I.Z,{size:"xs",type:"user",src:null==r?void 0:r.profile_pic_url,tooltip:null==r?void 0:r.name,alt:null==r?void 0:r.name,userId:Number(e),isPartner:i}),t?(0,j.jsx)(P,{}):(0,j.jsx)(h.ZP,{"data-testid":"user-name",isTruncated:!0,color:"content-color-secondary",children:null==r?void 0:r.name})]})},N=s().div.withConfig({displayName:"package-list-item__PackageListItem",componentId:"sc-yszomg-0"})(["padding:var(--spacing-l);border-top:var(--border-width-default) var(--border-style-solid) var(--border-color-default);&:last-child{border-bottom:var(--border-width-default) var(--border-style-solid) var(--border-color-default);}&:hover{background:",";cursor:pointer;}",""],(({selected:e})=>e?"var(--highlight-background-color-secondary)":"var(--background-color-secondary)"),(({selected:e})=>e&&"\n      background: var(--highlight-background-color-secondary);\n    ")),D=s()(g.Z).withConfig({displayName:"package-list-item__StyledSubComponent",componentId:"sc-yszomg-1"})(["margin-top:var(--spacing-xs);"]),L=s().div.withConfig({displayName:"package-list-item__StyledSummaryTextContainer",componentId:"sc-yszomg-2"})(["& > :last-child{margin-bottom:var(--spacing-xs);}"]),T=({isNew:e=!1,isNewInCreation:a,isSelected:t,onPackageSelection:n,packageItem:r,onCancelClick:o})=>{var s;return(0,j.jsx)(N,{selected:t,"data-testid":"package-library-list-item",onClick:async()=>{if(!e){if(a){const e=u.Modals.getModals(),a=["Discard to continue","Back to Package"],t=await e.showWarningDialog({uid:"new-package-discard",subject:"Discard this package?",message:"You are in the process of creating a package. Your progress will be lost if you proceed.",options:[{title:a[0],isDefaultOnDismiss:!0},{title:a[1],isPrimary:!0}]});if((null==t?void 0:t.title)===a[1])return;(null==t?void 0:t.title)===a[0]&&o()}r&&n(r.id)}},children:(0,j.jsxs)(g.Z,{direction:"column",gap:"spacing-xs",children:[(0,j.jsx)(w.Z,{type:"h4",text:e?"New package":null==r?void 0:r.name,isTruncated:!0}),!e&&r&&(0,j.jsxs)(i().Fragment,{children:[0!==(null==(s=r.description)?void 0:s.length)&&(0,j.jsx)(L,{children:(0,j.jsx)(h.ZP,{type:"body-medium",color:"content-color-secondary",maxLines:3,children:r.description})}),(0,j.jsx)(D,{alignItems:"center",children:(0,j.jsx)(E,{userId:r.createdBy})})]})]})},e||null==r?void 0:r.id)};var A=t(1397),z=t(5477),B=t(37);const M="https://go.pstmn.io/package-library",O=/^[a-z]/,V=/^[a-z0-9_-]*$/,F=()=>(0,j.jsxs)(g.Z,{alignItems:"center",gap:"spacing-s",children:[(0,j.jsx)(w.Z,{type:"h4",text:"Package Library"}),(0,j.jsxs)(g.Z,{gap:"spacing-xs",alignItems:"center",children:[(0,j.jsx)(A.Z,{content:"All team members have access to packages in the library",placement:"bottom",openDelay:1e3,children:(0,j.jsx)(z.Z,{"data-testid":"icon-descriptive-team-small"})}),(0,j.jsx)(c.Link,{type:"tertiary",to:M,target:"_blank",rel:"noopener noreferer","data-testid":"package-library-help-icon",children:(0,j.jsx)(v.Z,{type:"tertiary",icon:(0,j.jsx)(B.Z,{}),tooltip:(0,j.jsx)(A.Z,{content:"Learn more about packages",placement:"bottom",openDelay:1e3})})})]})]});var W=t(7560),U=t(2372),q=t(4250),$=t(856),R=t(4867);function H(e,a){const t=null==e||null==e.replace?void 0:e.replace(/[^\w !$%&'()*,./:=?{|}~-]/g,"");return null==t||null==t.replace?void 0:t.replace(/{{([^}]+)}}/g,((e,t)=>void 0===(null==a?void 0:a[t])?"":a[t]))}const G=s().div.withConfig({displayName:"config-template-renderer__CustomPopoverTriggerContainer",componentId:"sc-anyfjt-0"})(["user-select:none;cursor:pointer;"]);function K(e,a){return"object"!=typeof e?null:(0,j.jsx)(h.ZP,{type:null==e?void 0:e.variation,color:null==e?void 0:e.color,isExternal:null==e?void 0:e.isExternal,children:H(null==e?void 0:e.value,a)})}function Y(e,a){return"object"!=typeof e?null:(0,j.jsx)(U.Z,{text:H(null==e?void 0:e.value,a),color:null==e?void 0:e.color})}function Q(e,a,t,n){if(!e)return null;if(Array.isArray(e))return e.map((e=>Q(e,a,t,n)));switch(null==e?void 0:e.type){case"text":return Array.isArray(e.value)?(0,j.jsx)(h.ZP,{color:null==e?void 0:e.color,isExternal:null==e?void 0:e.isExternal,type:null==e?void 0:e.variation,children:e.value.map((e=>Q(e,a,t,n)))}):K(e,a);case"link":return function(e,a,t){return"object"!=typeof e?null:(0,j.jsx)(c.Link,{target:(null==e?void 0:e.target)||"_blank",to:H(null==e?void 0:e.to,a),onClick:()=>null==t?void 0:t(e),children:K(e,a)})}(e,a,n);case"heading":return function(e,a){return"object"!=typeof e?null:(0,j.jsx)(w.Z,{type:null==e?void 0:e.variation,text:H(null==e?void 0:e.value,a)})}(e,a);case"button":return function(e,a,t){return"object"!=typeof e?null:(0,j.jsx)(v.Z,{type:e.variation,text:H(null==e?void 0:e.value,a),onClick:()=>null==t?void 0:t(null==e?void 0:e.action)})}(e,a,t);case"tag":return Y(e,a);default:return null}}function X({config:e,variables:a,trigger:t,onButtonClick:i,onLinkClick:r}){const[o,s]=(0,n.useState)(!1);function l(){s((e=>!e))}const c=(0,j.jsx)(v.Z,{type:(null==e?void 0:e.closeButtonType)||"secondary",text:"Close",onClick:l});if(!e||"object"!=typeof e||!(0,p.isValidConfig)(e))return null;switch(null==e?void 0:e.type){case"banner":return(0,j.jsx)(q.Z,{hideIcon:null==e?void 0:e.hideIcon,status:null==e?void 0:e.status,title:H(null==e?void 0:e.title,a),children:Q(null==e?void 0:e.value,a,i,r)});case"text":return(0,j.jsxs)(g.Z,{gap:"spacing-s",width:"100%",children:[!e.hideIcon&&(0,j.jsx)(R.Z,{color:null==e?void 0:e.color}),(0,j.jsx)(h.ZP,{color:null==e?void 0:e.color,isExternal:null==e?void 0:e.isExternal,type:null==e?void 0:e.variation,children:Q(null==e?void 0:e.value,a,i,r)})]});case"popover":return(0,j.jsx)($.ZP,(0,W.Z)({},null!=e&&e.hasCloseButton?{isOpen:o}:{},{padding:"spacing-l",pointer:"true",placement:"bottom",triggerEvent:(null==e?void 0:e.triggerEvent)||"mouseenter",trigger:null!=e&&e.trigger?(0,j.jsx)(G,{onClick:l,children:Q(null==e?void 0:e.trigger,a,i,r)}):t,children:(0,j.jsxs)(g.Z,{direction:"column",gap:"spacing-l",children:[(0,j.jsx)(g.Z,{direction:"column",gap:"spacing-s",children:Q(null==e?void 0:e.value,a,i,r)}),((null==e?void 0:e.actions)||(null==e?void 0:e.hasCloseButton))&&(0,j.jsxs)(g.Z,{gap:"spacing-s",children:[(null==e?void 0:e.hasCloseButton)&&"actions-start"===(null==e?void 0:e.closeButtonPlacement)&&c,(null==e?void 0:e.actions)&&Q(null==e?void 0:e.actions,a,i,r),(null==e?void 0:e.hasCloseButton)&&"actions-end"===(null==e?void 0:e.closeButtonPlacement)&&c]})]})}));case"tag":return Y(e,a);default:return null}}const J=s()(g.Z).withConfig({displayName:"package-list__PackageListContainer",componentId:"sc-18h290z-0"})(["height:100%;width:100%;"]),ee=s()(g.Z).withConfig({displayName:"package-list__PackageList",componentId:"sc-18h290z-1"})(["overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none;&::-webkit-scrollbar{display:none;}"]),ae=s().div.withConfig({displayName:"package-list__SkeletonLoaderItem",componentId:"sc-18h290z-2"})(["height:100px;border-radius:var(--border-radius-default);background-color:var(--background-color-tertiary);animation:fade 1s linear infinite;width:100%;"]),te=s().div.withConfig({displayName:"package-list__SkeletonLoader",componentId:"sc-18h290z-3"})(["margin-top:var(--spacing-m);display:flex;flex-direction:column;gap:var(--spacing-m);width:100%;"]),ne=({isNewInCreation:e,selectedPackageId:a,onPackageSelection:t,onCreateClick:i,onCancelClick:r,packages:o,isLoadingPackages:s})=>{const[l,d]=(0,n.useState)(""),u=(0,x.useDebounce)(l),{planLimitMessageConfig:f,configTemplateVariables:w,isHardLimitReached:_,createNewPackageButtonTooltip:I}=(0,p.usePlanUsageData)(),Z=null!=o&&o.length?(0,j.jsx)(ee,{direction:"column",grow:1,shrink:1,children:(()=>{var n;let i=o;return u&&(i=null==o?void 0:o.filter((e=>e.name.toLowerCase().includes(u.toLowerCase())))),(0,j.jsxs)(j.Fragment,{children:[e&&(0,j.jsx)(T,{isNew:!0,isSelected:!0,onPackageSelection:t,onCancelClick:r}),null==(n=i)?void 0:n.map((n=>(0,j.jsx)(T,{isNewInCreation:e,isSelected:a===n.id,packageItem:n,onPackageSelection:t,onCancelClick:r},n.id)))]})})()}):(0,j.jsx)(g.Z,{children:(0,j.jsx)(m.Z,{title:"No packages in this team yet!",description:(0,j.jsxs)(h.ZP,{type:"para",children:["Packages help your team reuse common scripts. ",(0,j.jsx)(c.Link,{type:"plain",to:M,target:"_blank",children:(0,j.jsx)(h.ZP,{type:"link-default",children:"Learn more."})})]}),secondaryAction:(0,j.jsx)(v.Z,{type:"primary",size:"medium",onClick:()=>{b.AnalyticsService.addEventV2({category:"package_library",action:"initiate_package_creation",label:"create_package_button",variantId:"ide"}),i()},text:"Create Package","data-testid":"package-library__new-button"}),children:(0,j.jsx)(y.Z,{})})});return(0,j.jsxs)(J,{direction:"column",gap:"spacing-s",padding:"spacing-s spacing-m spacing-m spacing-s",children:[(0,j.jsxs)(g.Z,{alignItems:"center",justifyContent:"space-between",children:[(0,j.jsx)(F,{}),(0,j.jsx)(v.Z,{type:"tertiary",size:"medium",iconType:k.Z,text:"New Package",onClick:()=>{b.AnalyticsService.addEventV2({category:"package_library",action:"initiate_package_creation",label:"package_library_plus",variantId:"ide"}),i()},icon:(0,j.jsx)(k.Z,{}),"data-testid":"package-library__new-button",isDisabled:_,tooltip:H(I,w)})]}),f&&(0,j.jsx)(g.Z,{shrink:1,"data-testid":"package-usage-limit-message",children:(0,j.jsx)(X,{config:f,variables:w})}),(0,j.jsx)(C,{searchValue:l,onSearch:d}),s?(0,j.jsx)(te,{children:Array.from({length:25}).map(((e,a)=>(0,j.jsx)(ae,{},a)))}):Z]})};var ie=t(2135),re=t(1466),oe=t(1590),se=t(99);const le=s()(g.Z).withConfig({displayName:"package-library-empty-content__CodeBlock",componentId:"sc-m5cijv-0"})(["margin-left:var(--spacing-m);line-height:var(--line-height-m);pre{margin:0;padding:var(--spacing-s);}"]),ce=[{title:"1. Create a package with some reusable code.",snippet:"function add(a, b) {\n   return a + b;\n};"},{title:"2. Export the functions you want to reuse.",snippet:"module.exports = {add};"},{title:(0,j.jsxs)(j.Fragment,{children:["3. Use pm.require to use this package in your request,",(0,j.jsx)("br",{}),"    folder and collection scripts."]}),snippet:'const myScript = pm.require("package");\nmyScript.add();'}],de=()=>(0,j.jsx)(g.Z,{alignItems:"center",justifyContent:"center",grow:1,shrink:1,height:"100%",minWidth:"fit-content",children:(0,j.jsx)(g.Z,{direction:"column",gap:"spacing-xl",children:ce.map(((e,a)=>(0,j.jsxs)(g.Z,{direction:"column",gap:"spacing-s",justifyContent:"center",alignItems:"flex-start",children:[(0,j.jsx)(g.Z,{children:(0,j.jsx)(h.ZP,{children:e.title})}),(0,j.jsx)(le,{children:(0,j.jsx)(h.ZP,{type:"code",children:(0,j.jsx)("pre",{children:e.snippet})})})]},a)))})});var ue=t(4591);const pe=s()(f.Z).withConfig({displayName:"header-name__StyledTextNameArea",componentId:"sc-5xugud-0"})(["height:24px;padding-left:2px;&:hover{background-color:var(--background-color-secondary);}&:focus-within{background-color:var(--background-color-primary);}input{font-weight:",";font-size:14px;}box-shadow:",";"],(({value:e})=>""===e?"var(--text-weight-regular)":"var(--text-weight-bold)"),(({isEditing:e})=>e?"0 0 0 1px var(--request-url-highlight-border-color)":"none")),ge=s()(w.Z).withConfig({displayName:"header-name__StyledHeading",componentId:"sc-5xugud-1"})(["&:hover{cursor:text;background-color:var(--background-color-secondary);}border-radius:var(--border-radius-s);line-height:22px;font-size:14px;"]),me=s()(g.Z).withConfig({displayName:"header-name__PacakgeNameNote",componentId:"sc-5xugud-2"})(["margin-top:4px;position:relative;"]),he=s().div.withConfig({displayName:"header-name__StyledSkeletonParent",componentId:"sc-5xugud-3"})(["width:45%;"]);function ve({onChange:e,packageItem:a,autofocus:t,validationErrors:r}){const[o,s]=(0,n.useState)(t);return o||r.name||!a.name?(0,j.jsxs)(i().Fragment,{children:[(0,j.jsx)(pe,{value:a.name,onChange:({target:{value:a}})=>{e("name",a)},width:"45%",autoFocus:t,placeholder:"package-name",validationStatus:r.name?"error":null,validationMessage:r.name,onBlur:()=>{s(!1)},onFocus:()=>s(!0),isEditing:o,size:"small","data-testid":"package-library-content__name-input"}),!r.name&&o&&(0,j.jsxs)(me,{gap:"spacing-xs",justifyContent:"flex-start",alignItems:"center",children:[(0,j.jsx)(ue.Z,{color:"content-color-secondary"}),(0,j.jsx)(h.ZP,{type:"small",children:"Name cannot be changed after package creation"})]})]}):(0,j.jsx)(he,{onClick:()=>{s(!0)},children:(0,j.jsx)(ge,{type:"h4",text:a.name,isTruncated:!0})})}var ye=t(7110);const ke=s()(f.Z).withConfig({displayName:"header-summary__StyledTextArea",componentId:"sc-vbeje-0"})(["box-shadow:",";padding:0;height:18px;width:65%;&:hover{background-color:var(--background-color-secondary);}font-size:var(--text-size-s);&&&{color:var(--content-color-secondary);border:none;margin:none;}"],(({isEditing:e})=>e?"0 0 0 1px var(--request-url-highlight-border-color)":"none")),xe=s().div.withConfig({displayName:"header-summary__StyledSkeletonParent",componentId:"sc-vbeje-1"})(["&:hover{cursor:text;background-color:var(--background-color-secondary);}width:65%;line-height:22px;font-size:var(--text-size-xl);text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),be=s().div.withConfig({displayName:"header-summary__StyledWrapper",componentId:"sc-vbeje-2"})(["margin-top:var(--spacing-xs);"]);function fe({onChange:e,packageItem:a,validationErrors:t}){const[i,r]=(0,n.useState)(!1);return(0,j.jsx)(be,{children:i?(0,j.jsx)(ke,{placeholder:"Add a summary",value:a.description,onChange:({target:{value:a}})=>e("description",a),label:(0,j.jsx)(ye.Z,{}),validationStatus:t.description?"error":null,validationMessage:t.description,onBlur:()=>r(!1),autoFocus:!0,isEditing:i,size:"small","data-testid":"package-library-content__summary-input"}):(0,j.jsx)(xe,{onFocus:()=>{r(!0)},tabIndex:0,"data-testid":"package-library-content__summary-input",children:(0,j.jsx)(h.ZP,{color:a.description?"content-color-secondary":"content-color-tertiary",children:a.description||"Add a summary"})})})}const je=s()(g.Z).withConfig({displayName:"new-package-header__PackageDescriptionHeader",componentId:"sc-ak6vt3-0"})(["width:100%;padding:var(--spacing-l);border-bottom:var(--border-width-default) var(--border-style-solid) var(--border-color-default);"]),Ce=s()(v.Z).withConfig({displayName:"new-package-header__StyledButton",componentId:"sc-ak6vt3-1"})([":disabled{background-color:var(--button-primary-background-color) !important;color:var(--button-primary-content-color) !important;opacity:0.5;}"]),we=({packageItem:e,onChange:a,onSave:t,onCancel:n,isSaving:i,validationErrors:r,isDisabled:o})=>(0,j.jsxs)(je,{gap:"spacing-m",children:[(0,j.jsxs)(g.Z,{direction:"column",grow:1,shrink:1,minWidth:"0px",children:[(0,j.jsx)(ve,{packageItem:e,onChange:a,validationErrors:r,autofocus:!0}),(0,j.jsx)(fe,{packageItem:e,onChange:a,validationErrors:r})]}),(0,j.jsxs)(g.Z,{gap:"spacing-m",children:[(0,j.jsx)(Ce,{type:"primary",isLoading:i,text:"Create","data-testid":"package-library-content__create-button",onClick:t,isDisabled:o}),(0,j.jsx)(v.Z,{type:"secondary",text:"Cancel",onClick:n,"data-testid":"package-library-content__cancel-button"})]})]});var _e=t(4079),Ie=t(4691),Ze=t(8263),Se=t(9824),Pe=t(7282),Ee=t(4502),Ne=t(9225),De=t(4350),Le=t(3101);const Te=({packageItem:e,onChange:a,onSave:t,onDelete:n,isSaving:i,validationErrors:r,isSaveDisabled:o})=>{var s;const l=(0,Le.getUserId)(),{data:c}=(0,De.useEntityPermissions)(e.id+l,{checks:{canDeletePackage:{entityType:"user",entityId:l,permission:"DELETE_PACKAGE",objectType:"package",objectId:e.id}}}),d=null==c||null==(s=c.results)||null==(s=s.canDeletePackage)?void 0:s.allowed;return(0,j.jsx)(g.Z,{justifyContent:"space-between",alignItems:"center",children:(0,j.jsxs)(je,{gap:"spacing-m",grow:1,children:[(0,j.jsxs)(g.Z,{direction:"column",gap:"spacing-xs",grow:1,shrink:1,minWidth:"0px",children:[(0,j.jsx)(g.Z,{width:"45%",children:(0,j.jsx)(w.Z,{type:"h4",text:e.name,isTruncated:!0})}),(0,j.jsx)(fe,{packageItem:e,onChange:a,validationErrors:r})]}),(0,j.jsxs)(g.Z,{gap:"spacing-s",alignItems:"flex-start",children:[(0,j.jsx)(_e.Z,{children:(0,j.jsx)(v.Z,{type:"tertiary",isLoading:i,"data-testid":"package-library-content__save-button",icon:(0,j.jsx)(Ee.Z,{}),text:"Save",isDisabled:o,onClick:t})}),(0,j.jsxs)(Ie.Z,{children:[(0,j.jsx)(Ze.Z,{children:(0,j.jsx)(v.Z,{icon:(0,j.jsx)(Ne.Z,{}),type:"tertiary","data-testid":"package-library-content__actions"})}),(0,j.jsx)(Se.Z,{placement:"bottom-end",children:(0,j.jsx)(Pe.Z,{isDisabled:!d,"data-testid":"package-library-content__delete-button",type:"destructive",onClick:n,children:"Delete"})})]})]})]})})},Ae=["jsLib","node","postman-collection","chai","pre-script"];var ze=t(7201);const Be=(0,n.lazy)((0,oe.loadRemoteModule)("code-editor/CodeEditor")),Me=i().forwardRef(((e,a)=>(0,j.jsx)(n.Suspense,{fallback:(0,j.jsx)(_.Z,{}),children:(0,j.jsx)(Be,(0,W.Z)({},e,{ref:a}))}))),Oe=s().div.withConfig({displayName:"package-library-content__EditorContainer",componentId:"sc-favmxv-0"})(["width:100%;height:100%;flex:1;overflow-y:auto;"]),Ve=s()(g.Z).withConfig({displayName:"package-library-content__BlankStateWrapper",componentId:"sc-favmxv-1"})(["overflow:hidden;"]),Fe=(0,n.forwardRef)((({packages:e,selectedPackage:a,isNew:t,setIsNew:i,setSelectedPackageId:r,setIsDirty:o,onCancelClick:s,isLoadingPackageLibrary:l,setIsLoadingPackageLibrary:c},h)=>{var y,k,x,f,C;const w=(0,se.useActiveWorkspaceId)(),{addToast:I}=d.Toast.getToasts(),Z=u.Modals.getModals(),{mutate:S,isLoading:P}=(0,p.useCreatePackage)(),{mutateAsync:E,isLoading:N}=(0,p.useUpdatePackage)(),{mutateAsync:D,isLoading:L}=(0,p.useUpdateScript)(),{mutate:T}=(0,p.useDeletePackage)(),{data:A,isLoading:z,fetchStatus:B,isError:M,refetch:F}=(0,p.useScript)({packageId:null==a?void 0:a.id,scriptId:null==a||null==(y=a.indexScript)?void 0:y.id}),[U,q]=(0,n.useState)(null),$=P||N||L,R=t||!z&&(null==U?void 0:U.id)===(null==a?void 0:a.id)&&(null==U||null==(k=U.script)?void 0:k.id)===(null==a||null==(x=a.indexScript)?void 0:x.id),H={script:!!R&&void 0!==(null==U?void 0:U.script.sourceCode)&&(null==A||null==(f=A.contents)?void 0:f.src)!==(null==U?void 0:U.script.sourceCode),description:!!R&&(null==U?void 0:U.description)!==(null==a?void 0:a.description)},G=H.script||H.description,K=$?{name:"",description:""}:function({packages:e,packageItem:a,isNew:t=!1}){var n;if(!a)return{};const i={};return null!=a&&a.name&&(O.test(a.name)?V.test(a.name)?0===a.name.trim().length?i.name="Package name cannot be empty.":a.name.length>200?i.name="Package name cannot be more than 200 characters.":t&&e.find((e=>e.name===a.name))&&(i.name=`A package with ${a.name} already exists in your team.`):i.name="Package name must only contain lowercase alphabets, digits, hyphens (-), or underscores (_).":i.name="Package name must start with a lowercase alphabet."),(null==a||null==(n=a.description)?void 0:n.length)>140&&(i.description="Summary can't exceed 140 characters."),i}({packages:e||[],packageItem:U,isNew:t}),Y=Object.keys(K||{}).length>0,Q=e=>{I({status:"error",description:e})},X=(e,a)=>{q((t=>(0,W.Z)({},t,{[e]:a})))},J=(e,a)=>D({packageId:e,scriptId:a,patches:[{op:"replace",path:"/contents/src",value:null==U?void 0:U.script.sourceCode}]},{onError:()=>{Q("Error saving the script. Please try again")}}),ee=async()=>{if(t)return void(null!=U&&U.name?S({workspaceId:w,requestBody:{name:null==U?void 0:U.name,description:null==U?void 0:U.description}},{onError:e=>{const a=e.body.detail||"Error creating the package. Please try again.";Q(a)},onSuccess:e=>{i(!1);const{id:a,indexScript:t}=e.data;var n,o;n=a,o=t.id,q((e=>(0,W.Z)({},e,{id:n,script:(0,W.Z)({},null==e?void 0:e.script,{id:o})}))),r(n),b.AnalyticsService.addEventV2({category:"package_library",action:"create_new_package",entityType:"package",entityId:a,variantId:"ide"}),(0,ze.updateCache)({key:(0,p.getScriptQuery)(null==e?void 0:e.data.id,null==e?void 0:e.data.indexScript.id).queryKey,updater:()=>({id:t.id,contents:{src:null==U?void 0:U.script.sourceCode},createdAt:(new Date).toISOString(),lastRetrievedAt:(new Date).toISOString()})}),H.script&&J(a,t.id)}}):I({status:"error",description:"Package name cannot be empty."}));const e=[];H.description&&e.push(E({packageId:null==U?void 0:U.id,patches:[{op:"replace",path:"/description",value:null==U?void 0:U.description}]},{onError:()=>{Q("Error updating the package. Please try again.")},onSettled:()=>{b.AnalyticsService.addEventV2({category:"package_library",action:"update_existing_package",entityType:"package",entityId:null==U?void 0:U.id,variantId:"ide"})}})),H.script&&e.push(J(null==U?void 0:U.id,null==a?void 0:a.indexScript.id)),await Promise.all(e)};return(0,n.useImperativeHandle)(h,(()=>({handleSave:ee}))),(0,n.useEffect)((()=>{z||c(!1)}),[z]),(0,n.useEffect)((()=>{if(t)q({id:"",name:"",description:"",script:{sourceCode:"// Use module.exports to export the functions that should be\n// available to use from this package.\n// module.exports = { <your_function> }\n\n// Once exported, use this statement in your scripts to use the package.\n// const myPackage = pm.require('<package_name>')"}});else if(a){const{id:e,name:t,description:n,indexScript:i}=a;q((a=>{var r;return{id:e,name:t,description:n,script:(0,W.Z)({},i,{sourceCode:a&&a.id===e?null==(r=a.script)?void 0:r.sourceCode:void 0})}}))}else q(null)}),[t,a]),(0,n.useEffect)((()=>{var e;!z&&null!=A&&null!=(e=A.contents)&&e.src&&a&&q((e=>(0,W.Z)({},e,{script:{id:a.indexScript.id,sourceCode:A.contents.src}})))}),[z,null==A||null==(C=A.contents)?void 0:C.src,a]),(0,n.useEffect)((()=>{o(G)}),[G]),!t&&z&&"fetching"===B||l?(0,j.jsx)(g.Z,{justifyContent:"center",height:"100%",children:(0,j.jsx)(_.Z,{})}):M?(0,j.jsx)(Ve,{direction:"column",height:"100%",justifyContent:"center",alignItems:"center",children:(0,j.jsx)(m.Z,{title:"Unable to load this package",description:"Try refreshing or check back in some time.",primaryAction:(0,j.jsx)(v.Z,{type:"primary",text:"Refresh",onClick:F}),children:(0,j.jsx)(ie.Z,{})})}):U?(0,j.jsxs)(j.Fragment,{children:[t?(0,j.jsx)(we,{packageItem:U,isSaving:$,validationErrors:K,isDisabled:Y,onChange:X,onSave:ee,onCancel:s}):(0,j.jsx)(Te,{packageItem:U,isSaving:$,validationErrors:K,isSaveDisabled:!G||Y,onChange:X,onSave:ee,onDelete:async()=>{b.AnalyticsService.addEventV2({category:"package_library",action:"initiate_delete_package",entityType:"package",entityId:null==U?void 0:U.id,variantId:"ide"}),await(async()=>await re.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"SHOW_INPUT_BOX",payload:{title:`Delete "${null==U?void 0:U.name}"`,ignoreFocusOut:!0,prompt:`To confirm, type package name "${null==U?void 0:U.name}" above`}})===(null==U?void 0:U.name)||(I({status:"error",description:"Package name does not match. Please try again."}),!1))()&&await(async()=>{const e=await Z.showWarningDialog({uid:"package-library-delete-package",subject:`Delete ${null==U?void 0:U.name}?`,message:"Are you sure you want to permanently delete the package?",options:[{title:"Cancel",isDefaultOnDismiss:!0},{title:"Delete",isPrimary:!0}]});return"Delete"===(null==e?void 0:e.title)})()&&T({packageId:null==U?void 0:U.id},{onError:()=>{Q("Error deleting the package. Please try again")},onSettled:e=>{r(null),b.AnalyticsService.addEventV2({category:"package_library",action:"confirm_delete_package",entityType:"package",entityId:null==U?void 0:U.id,variantId:"ide"})}})}}),(0,j.jsx)(Oe,{"data-testid":"package-library-content__script-editor",children:(0,j.jsx)(Me,{hideActionBar:!0,typeDefinitionTypes:[...Ae],onChange:e=>{q((a=>(0,W.Z)({},a,{script:(0,W.Z)({},null==a?void 0:a.script,{sourceCode:e})})))},value:null==U?void 0:U.script.sourceCode,readOnly:$,language:"javascript"})})]}):(0,j.jsx)(de,{})})),We=s().div.withConfig({displayName:"package-library__PackageManagerContainer",componentId:"sc-180rtsj-0"})(["height:100vh;"]),Ue=s()(d.PaneGroup).withConfig({displayName:"package-library__StyledPaneGroup",componentId:"sc-180rtsj-1"})(["height:100%;"]),qe=s()(d.PaneContent).withConfig({displayName:"package-library__StyledPaneContent",componentId:"sc-180rtsj-2"})(["height:100%;"]),$e=()=>{const{setTabTitle:e}=(0,c.useTabTitleMeta)(),{packageId:a}=(0,r.useParams)(),t=u.Modals.getModals(),[i,o]=(0,n.useState)(!0),[s,l]=(0,n.useState)(!1),[g,m]=(0,n.useState)(!1),[h,v]=(0,n.useState)(a||null),y=(0,n.useRef)(null),{data:k,isLoading:x,isError:b}=(0,p.usePackages)({isDeleted:!1}),f=(0,n.useMemo)((()=>h&&k&&k.find((e=>e.id===h))||null),[k,h]),C=async()=>{const e="Discard Changes",a="Save Changes",n=await t.showWarningDialog({uid:"package-library-unsaved-changes-package",subject:`Save changes to "${null==f?void 0:f.name}"?`,message:`There are some unsaved changes in the current package "${null==f?void 0:f.name}" which will be lost if you proceed.`,options:[{title:e,isDefaultOnDismiss:!0},{title:"Cancel"},{title:a,isPrimary:!0}]});return(null==n?void 0:n.title)===e||(null==n?void 0:n.title)===a&&(await(null==(i=y.current)||null==i.handleSave?void 0:i.handleSave()),!0);var i},w=()=>{var e;l(!1),m(!1);const a=k?null==(e=k[0])?void 0:e.id:null;v(a)};return(0,n.useEffect)((()=>{x||!b&&0!==k.length||o(!1)}),[x,b]),(0,n.useEffect)((()=>{k&&k.length>0&&!h&&!s&&v(a||k[0].id)}),[k,h,a]),(0,n.useEffect)((()=>{e("Package Library","package-library",{isDirty:g})}),[g]),(0,j.jsx)(We,{children:(0,j.jsxs)(Ue,{defaultLayout:"horizontal",children:[(0,j.jsx)(d.Pane,{width:{min:300,max:400},children:(0,j.jsx)(qe,{children:(0,j.jsx)(ne,{packages:k,isLoadingPackages:x,selectedPackageId:s?null:h,isNewInCreation:s,onCancelClick:w,onPackageSelection:async e=>{if(e!==h){if(g&&!s&&!await C())return;v(e)}},onCreateClick:async()=>{if(!s){if(g&&!await C())return;i&&o(!1),l(!0),v(null)}}})})}),(0,j.jsx)(d.Pane,{children:(0,j.jsx)(qe,{children:(0,j.jsx)(Fe,{ref:y,packages:k,isNew:s,setIsNew:l,selectedPackage:f,setSelectedPackageId:v,setIsDirty:m,onCancelClick:w,setIsLoadingPackageLibrary:o,isLoadingPackageLibrary:i})})})]})})},Re=function(){return(0,j.jsx)(l.VW,{children:(0,j.jsx)($e,{})})}}}]);
//# sourceMappingURL=1592.009eb731d304e65b.js.map